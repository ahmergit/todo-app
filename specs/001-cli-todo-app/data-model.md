# Data Model: CLI Todo Application

**Feature**: 001-cli-todo-app
**Phase**: 1 (Design & Contracts)
**Date**: 2025-12-05

## Overview

This document defines the data entities, their attributes, relationships, validation rules, and state transitions for the CLI todo application. All data is stored in-memory with no persistence between sessions.

## Entities

### Task

Represents a single todo item that users can create, view, update, complete, and delete.

**Attributes**:

| Attribute | Type | Required | Default | Constraints | Description |
|-----------|------|----------|---------|-------------|-------------|
| `id` | int | Yes | Auto-generated | Unique, positive integer, never reused | Unique identifier for the task |
| `description` | str | Yes | None | 1-500 characters, non-empty after strip | What needs to be done |
| `priority` | Priority (enum) | Yes | MEDIUM | Must be HIGH, MEDIUM, or LOW | Task importance level |
| `completed` | bool | Yes | False | Boolean | Whether the task is done |
| `created_at` | datetime | Yes | Auto-generated (now) | ISO 8601 timestamp | When the task was created |

**Python Type Definition**:
```python
from dataclasses import dataclass, field
from datetime import datetime
from enum import Enum

class Priority(Enum):
    """Task priority levels"""
    HIGH = "High"
    MEDIUM = "Medium"
    LOW = "Low"

@dataclass
class Task:
    """
    Represents a single todo task.

    Attributes:
        id: Unique integer identifier (auto-assigned, never reused)
        description: Text description of the task (1-500 chars)
        priority: Task priority (HIGH, MEDIUM, or LOW)
        completed: Whether the task is complete
        created_at: Timestamp when task was created
    """
    id: int
    description: str
    priority: Priority = Priority.MEDIUM
    completed: bool = False
    created_at: datetime = field(default_factory=datetime.now)

    def __post_init__(self):
        """Validate task attributes after initialization"""
        if not isinstance(self.id, int) or self.id <= 0:
            raise ValueError("Task ID must be a positive integer")

        if not isinstance(self.description, str):
            raise TypeError("Description must be a string")

        description = self.description.strip()
        if not description:
            raise ValueError("Description cannot be empty")

        if len(description) > 500:
            raise ValueError("Description cannot exceed 500 characters")

        if not isinstance(self.priority, Priority):
            raise TypeError("Priority must be a Priority enum value")

        if not isinstance(self.completed, bool):
            raise TypeError("Completed must be a boolean")
```

**Validation Rules** (from FR-011, FR-012, FR-020):

1. **ID Validation**:
   - Must be positive integer
   - Must be unique within session
   - Never reused after deletion
   - Auto-generated by TaskManager

2. **Description Validation**:
   - Required (cannot be None or empty)
   - Whitespace trimmed before validation
   - Minimum: 1 character after trim
   - Maximum: 500 characters
   - Accepts ASCII and common Unicode characters

3. **Priority Validation**:
   - Must be one of: Priority.HIGH, Priority.MEDIUM, Priority.LOW
   - String inputs ("H", "M", "L") converted at UI layer
   - Invalid priority values default to MEDIUM with warning

4. **Completed Validation**:
   - Must be boolean (True/False)
   - Cannot complete an already completed task (UI prevents, returns message)

5. **Created Timestamp**:
   - Automatically set on creation
   - Immutable (never updated)
   - Used for internal ordering (not displayed in MVP)

---

### TaskList (Collection)

The in-memory collection of all tasks for the current session. Implemented as a Python list within TaskManager.

**Attributes**:

| Attribute | Type | Description |
|-----------|------|-------------|
| `_tasks` | list[Task] | Ordered list of tasks (private) |
| `_next_id` | int | Next available task ID (private, auto-incremented) |

**Invariants**:

1. Tasks maintain insertion order (creation order)
2. Task IDs are strictly incrementing (no gaps after deletion in ID sequence)
3. All task IDs are unique within the list
4. Maximum 1000 tasks per session (soft limit for performance)

**Operations**:

| Operation | Input | Output | Side Effects |
|-----------|-------|--------|--------------|
| `add` | description, priority (optional) | Task | Appends task to list, increments _next_id |
| `get_by_id` | task_id | Task \| None | None |
| `get_all` | None | list[Task] | None |
| `update` | task_id, new_description | bool | Modifies task description if found |
| `delete` | task_id | bool | Removes task from list if found |
| `toggle_complete` | task_id | bool | Toggles completed status if found |
| `set_priority` | task_id, priority | bool | Updates priority if found |

---

## State Transitions

### Task Completion State Machine

```
┌─────────────┐
│  INCOMPLETE │  (completed = False)
│   (default) │
└──────┬──────┘
       │
       │ User action: "Complete Task"
       │ Transition: toggle_complete(task_id)
       ▼
┌─────────────┐
│  COMPLETED  │  (completed = True)
│  (terminal) │
└─────────────┘

Notes:
- Attempting to complete an already completed task returns error message
- Completed tasks can still be updated (description, priority)
- Completed tasks can be deleted
- No "uncomplete" operation in MVP (would require new feature)
```

### Priority State Transitions

```
    ┌─────────────────────────────┐
    │                             │
    ▼                             │
┌───────┐   set_priority()   ┌───────┐   set_priority()   ┌───────┐
│  HIGH │◄─────────────────► │MEDIUM │◄─────────────────► │  LOW  │
└───────┘                    └───────┘                    └───────┘
    │           ▲                  ▲           │               │
    │           │                  │           │               │
    └───────────┴──────────────────┴───────────┴───────────────┘
              set_priority() allows any transition

Notes:
- All priority transitions are bidirectional
- Default priority is MEDIUM
- Priority can be set during creation or changed later
- Priority changes do not affect completion status
```

---

## Relationships

### Task ↔ TaskList

- **Relationship Type**: Composition (TaskList owns Tasks)
- **Cardinality**: One TaskList contains zero or many Tasks (0..*)
- **Lifecycle**: Tasks are created and destroyed through TaskList operations
- **Referential Integrity**: Task IDs are unique within TaskList; invalid IDs return None/error

```
TaskList (1) ──contains──► (0..*) Task
```

**Navigation**:
- TaskList → Task: By ID (linear search O(n))
- Task → TaskList: Not applicable (tasks don't reference the list)

---

## Data Flow

### Task Creation Flow

```
User Input (description, optional priority)
    │
    ▼
UI Layer (validate input)
    │
    ▼
TaskManager.add_task(description, priority)
    │
    ├─ Generate ID (_next_id++)
    ├─ Create Task object
    ├─ Append to _tasks list
    │
    ▼
Return Task object
    │
    ▼
UI Layer (format and display confirmation)
```

### Task Retrieval Flow

```
User Input (task_id or "view all")
    │
    ▼
UI Layer (validate task_id)
    │
    ▼
TaskManager.get_by_id(task_id) OR TaskManager.get_all()
    │
    ├─ Linear search through _tasks
    │
    ▼
Return Task | None | list[Task]
    │
    ▼
UI Layer (format with colors, display)
```

### Task Update Flow

```
User Input (task_id, new_description)
    │
    ▼
UI Layer (validate inputs)
    │
    ▼
TaskManager.update(task_id, new_description)
    │
    ├─ Find task by ID
    ├─ Validate description
    ├─ Mutate task.description (dataclass allows mutation by default)
    │
    ▼
Return success boolean
    │
    ▼
UI Layer (display confirmation or error)
```

---

## Persistence Model

**Storage Strategy**: Transient in-memory storage

- **Location**: Python list in TaskManager instance (heap memory)
- **Lifetime**: Application session only (from start to exit)
- **Durability**: None - all data lost on application exit
- **Backup**: None
- **Recovery**: None

**Rationale** (from spec):
- FR-014: "System MUST store all task data in memory during the application session"
- FR-015: "System MUST clear all task data when the application exits"
- Assumption 2: "No persistence required: Tasks exist only during the application runtime"

---

## Performance Considerations

### Time Complexity

| Operation | Complexity | Justification |
|-----------|------------|---------------|
| Add task | O(1) | Append to list + ID increment |
| Get all tasks | O(n) | Return entire list |
| Get by ID | O(n) | Linear search |
| Update task | O(n) | Linear search + mutation |
| Delete task | O(n) | Linear search + list.remove |
| Toggle complete | O(n) | Linear search + mutation |

**Acceptable for n ≤ 1000** (from FR-019 and SC-005: <100ms for 1000 tasks)

### Space Complexity

- **Per Task**: ~200 bytes (rough estimate: int + str + enum + bool + datetime)
- **1000 Tasks**: ~200 KB total
- **Well within memory constraints**: No memory concerns for target scale

---

## Testing Strategy

### Unit Tests (tests/unit/test_models.py)

1. **Task Creation**:
   - Valid task with all fields
   - Task with default priority (MEDIUM)
   - Task with default completed (False)
   - Invalid ID (negative, zero) - expect ValueError
   - Invalid description (empty, too long) - expect ValueError
   - Invalid type for fields - expect TypeError

2. **Task Validation**:
   - Whitespace-only description - expect ValueError
   - 500-character description - should pass
   - 501-character description - expect ValueError
   - Unicode characters in description - should pass

### Contract Tests (tests/contract/test_manager_contract.py)

1. **TaskManager Interface**:
   - add_task returns Task with unique ID
   - get_by_id with valid ID returns Task
   - get_by_id with invalid ID returns None
   - get_all returns list (empty or populated)
   - update with valid ID returns True
   - delete with valid ID returns True
   - ID sequence increments correctly (1, 2, 3...)
   - IDs never reused after deletion

---

## Migration Strategy

**Not Applicable**: In-memory only, no database migrations required.

**Future Evolution** (if persistence added):
- Add optional persistence layer (JSON file, SQLite)
- Maintain same Task dataclass interface
- TaskManager becomes abstract interface with implementations:
  - InMemoryTaskManager (current)
  - FileTaskManager (future)
  - DatabaseTaskManager (future)

---

## Summary

The data model defines a single core entity (Task) with five attributes, stored in an in-memory list. State transitions are simple (incomplete ↔ complete, priority changes). All validation happens at creation/update time. Performance characteristics (O(n) operations) are acceptable for the target scale (≤1000 tasks). The model satisfies all functional requirements and is fully testable.
